<?xml version="1.0" encoding="UTF-8"?>
<testFlow id="dashboard_stats_display_flow" version="1.0">
  <metadata>
    <name>Dashboard Stats Display Flow</name>
    <description>Tests that dashboard statistics cards load and display correctly</description>
    <priority>critical</priority>
    <estimatedDuration>2m</estimatedDuration>
    <tags>
      <tag>dashboard</tag>
      <tag>statistics</tag>
      <tag>metrics</tag>
      <tag>ui</tag>
    </tags>
  </metadata>

  <prerequisites>
    <prerequisite>User authenticated with active subscription</prerequisite>
    <prerequisite>User has some call history</prerequisite>
  </prerequisites>

  <testData>
    <variable name="baseUrl" value="https://voicefleet.ai" />
  </testData>

  <steps>
    <step id="1" type="navigation">
      <action>Navigate to dashboard</action>
      <url>${baseUrl}/dashboard</url>
      <expectedResult>
        <condition type="pageLoaded">true</condition>
        <condition type="authenticated">true</condition>
      </expectedResult>
    </step>

    <step id="2" type="verification">
      <action>Verify welcome message displays</action>
      <expectedResult>
        <condition type="textPresent">Welcome back</condition>
        <condition type="elementVisible">User name or greeting</condition>
      </expectedResult>
    </step>

    <step id="3" type="verification">
      <action>Verify Calls Answered stat card</action>
      <target selector="[data-stat='calls-answered']" />
      <expectedResult>
        <condition type="elementVisible">Calls Answered card</condition>
        <condition type="textPresent">Calls Answered</condition>
        <condition type="numberDisplayed">Numeric value or 0</condition>
        <condition type="iconVisible">Phone icon</condition>
      </expectedResult>
    </step>

    <step id="4" type="verification">
      <action>Verify Messages Taken stat card</action>
      <target selector="[data-stat='messages-taken']" />
      <expectedResult>
        <condition type="elementVisible">Messages Taken card</condition>
        <condition type="textPresent">Messages Taken</condition>
        <condition type="numberDisplayed">Numeric value or 0</condition>
      </expectedResult>
    </step>

    <step id="5" type="verification">
      <action>Verify Voicemails stat card</action>
      <target selector="[data-stat='voicemails']" />
      <expectedResult>
        <condition type="elementVisible">Voicemails card</condition>
        <condition type="textPresent">Voicemails</condition>
        <condition type="numberDisplayed">Numeric value or 0</condition>
      </expectedResult>
    </step>

    <step id="6" type="verification">
      <action>Verify Call Minutes stat card</action>
      <target selector="[data-stat='call-minutes']" />
      <expectedResult>
        <condition type="elementVisible">Call Minutes card</condition>
        <condition type="textPresent">Call Minutes</condition>
        <condition type="numberDisplayed">Numeric value or 0</condition>
      </expectedResult>
    </step>

    <step id="7" type="verification">
      <action>Verify API call for stats</action>
      <target type="network">GET /api/users/stats</target>
      <expectedResult>
        <condition type="apiResponse">200 OK</condition>
        <condition type="responseContains">callsAnswered</condition>
        <condition type="responseContains">messagesTaken</condition>
        <condition type="responseContains">voicemails</condition>
        <condition type="responseContains">callMinutes</condition>
      </expectedResult>
    </step>

    <step id="8" type="verification">
      <action>Verify stats cards are responsive</action>
      <target type="viewport">mobile (375px)</target>
      <expectedResult>
        <condition type="layout">Cards stack vertically on mobile</condition>
        <condition type="noOverflow">true</condition>
      </expectedResult>
    </step>
  </steps>

  <teardown>
    <step>
      <action>No cleanup needed</action>
    </step>
  </teardown>

  <notes>
    <note>Stats should show 0 for new users with no calls</note>
    <note>Loading state should show skeleton or spinner</note>
    <note>Error state should show graceful fallback</note>
  </notes>
</testFlow>
